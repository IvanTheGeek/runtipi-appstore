{
    "$schema": "../compose-schema.json",
    "services": [
      {
        "image": "vikunja/vikunja:0.24.2",
        "name": "vikunja",
        "internalPort": 3456,
        "isMain": true,
        "environment": {
          "VIKUNJA_DATABASE_HOST": "vikunja-db",
          "VIKUNJA_DATABASE_PASSWORD": "${VIKUNJA_DB_PASSWORD}",
          "VIKUNJA_DATABASE_TYPE": "postgres",
          "VIKUNJA_DATABASE_USER": "tipi",
          "VIKUNJA_DATABASE_DATABASE": "vikunja",
          "VIKUNJA_SERVICE_JWTSECRET": "${VIKUNJA_SERVICE_SECRET}",
          "VIKUNJA_SERVICE_PUBLICURL": "${APP_PROTOCOL:-http}://${APP_DOMAIN}/"
        },
        "volumes": [
          {
            "hostPath": "${APP_DATA_DIR}/data/files",
            "containerPath": "/app/vikunja/files"
          }
        ],
        "dependsOn": {
          "vikunja-db": {
            "condition": "service_healthy"
          }
        }
      },
      {
        "image": "postgres:14",
        "name": "vikunja-db",
        "environment": {
          "POSTGRES_PASSWORD": "${VIKUNJA_DB_PASSWORD}",
          "POSTGRES_USER": "tipi",
          "POSTGRES_DB": "vikunja"
        },
        "volumes": [
          {
            "hostPath": "${APP_DATA_DIR}/data/db",
            "containerPath": "/var/lib/postgresql/data"
          }
        ],
        "healthCheck": {
          "test": "pg_isready -U $$POSTGRES_USER -d $$POSTGRES_DB",
          "interval": "5s",
          "timeout": "5s",
          "retries": 5
        }
      }
    ]
  }